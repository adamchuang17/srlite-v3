<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>SimpleReceiveLite v3.1</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; color:#0f172a }
    h1 { color: #2c3e50; margin-bottom:8px }
    label { display: block; margin-top: 10px; }
    select, input { padding: 6px 8px; margin-top: 5px; width: 220px; }
    button { margin-top: 12px; padding: 8px 14px; border:0; border-radius:6px; background:#22c55e; color:#fff; cursor:pointer }
    button.secondary { background:#0ea5e9 }
    button.warn { background:#ef4444 }
    table { border-collapse: collapse; margin-top: 18px; width: 100%; }
    th, td { border: 1px solid #e5e7eb; padding: 8px; text-align: center; font-size:14px }
    th { background: #f8fafc; }
    .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .tip{color:#64748b; font-size:12px}
  </style>
</head>
<body>
  <h1>ğŸ“¦ SimpleReceiveLite v3.1</h1>
  <div class="tip">ï¼ˆå·²å…§å»º å¾…ç°½æ”¶ / å·²ç°½æ”¶ / CSV åŒ¯å‡ºï¼‰</div>

  <!-- æ–°å¢ç´€éŒ„è¡¨å–® -->
  <form id="receiveForm">
    <label>æ£Ÿåˆ¥ï¼š
      <select id="building" required>
        <option value="">è«‹é¸æ“‡</option>
        <option value="47">ç”²æ£Ÿ (47)</option>
        <option value="47-7">ä¹™æ£Ÿ (47-7)</option>
        <option value="47-6">ä¸™æ£Ÿ (47-6)</option>
        <option value="47-5">ä¸æ£Ÿ (47-5)</option>
        <option value="47-3">æˆŠæ£Ÿ (47-3)</option>
        <option value="47-1">å·±æ£Ÿ (47-1)</option>
      </select>
    </label>

    <label>æ¨“å±¤ï¼š
      <select id="floor" required></select>
    </label>

    <label>æˆ¶è™Ÿï¼š
      <select id="unit" required></select>
    </label>

    <label>è²¨ä»¶é¡å‹ï¼š
      <select id="type" required>
        <option value="">è«‹é¸æ“‡</option>
        <option value="åŒ…è£¹">åŒ…è£¹</option>
        <option value="æ›è™Ÿ">æ›è™Ÿ</option>
      </select>
    </label>

    <label>æ”¶ä»¶äººï¼š
      <input id="receiver" list="receiverList" placeholder="è¼¸å…¥æˆ–é¸æ“‡" required />
      <datalist id="receiverList"></datalist>
    </label>

    <label>ä»¶æ•¸ï¼š
      <input id="count" type="number" min="1" value="1" required />
    </label>

    <label>è²¨é‹å…¬å¸ï¼š
      <input id="company" list="companyList" placeholder="è¼¸å…¥æˆ–é¸æ“‡" />
      <datalist id="companyList"></datalist>
    </label>

    <label>å‚™è¨»ï¼š
      <input id="note" placeholder="æ“ºæ”¾ä½ç½®æˆ–å‚™è¨»" />
    </label>

    <button type="submit">æ–°å¢ç´€éŒ„</button>
    <span id="status" class="tip"></span>
  </form>

  <!-- å·¥å…·åˆ— -->
  <div class="toolbar">
    <button id="exportToday" class="secondary">ä¸‹è¼‰ä»Šæ—¥ç´€éŒ„</button>
    <button id="exportAll" class="secondary">ä¸‹è¼‰å…¨éƒ¨ç´€éŒ„</button>
    <button id="exportPending" class="secondary">ä¸‹è¼‰å¾…ç°½æ”¶</button>
    <button id="exportSigned" class="secondary">ä¸‹è¼‰å·²ç°½æ”¶</button>
    <button id="clearAll" class="warn">æ¸…ç©ºæ‰€æœ‰ç´€éŒ„</button>
  </div>

  <!-- å¾…ç°½æ”¶ç´€éŒ„ -->
  <h3>ğŸ“‹ å¾…ç°½æ”¶ç´€éŒ„</h3>
  <table id="pendingTable">
    <thead>
      <tr>
        <th>æ™‚é–“</th><th>æµæ°´è™Ÿ</th><th>åœ°å€</th><th>æ”¶ä»¶äºº</th>
        <th>ä»¶æ•¸</th><th>è²¨é‹å…¬å¸</th><th>å‚™è¨»</th><th>ç°½æ”¶</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- å·²ç°½æ”¶ç´€éŒ„ -->
  <h3>âœ… å·²ç°½æ”¶ç´€éŒ„</h3>
  <table id="signedTable">
    <thead>
      <tr>
        <th>æ™‚é–“</th><th>æµæ°´è™Ÿ</th><th>åœ°å€</th><th>æ”¶ä»¶äºº</th>
        <th>ä»¶æ•¸</th><th>è²¨é‹å…¬å¸</th><th>å‚™è¨»</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const buildingSel = document.getElementById("building");
    const floorSel = document.getElementById("floor");
    const unitSel = document.getElementById("unit");
    const receiverList = document.getElementById("receiverList");
    const companyList = document.getElementById("companyList");
    const pendingBody = document.querySelector("#pendingTable tbody");
    const signedBody = document.querySelector("#signedTable tbody");
    const form = document.getElementById("receiveForm");
    const status = document.getElementById("status");

    // åˆå§‹åŒ–æ¨“å±¤ã€æˆ¶è™Ÿ
    function initSelectors() {
      floorSel.innerHTML = '<option value="">è«‹é¸æ“‡</option>';
      for (let i=1;i<=14;i++) floorSel.add(new Option(i+"æ¨“",i+"æ¨“"));
      unitSel.innerHTML = '<option value="">è«‹é¸æ“‡</option>';
      for (let i=1;i<=8;i++) unitSel.add(new Option("ä¹‹"+i,"ä¹‹"+i));
    }
    initSelectors();

    // ç´€éŒ„
    let records = JSON.parse(localStorage.getItem("records")||"[]");
    let signed = JSON.parse(localStorage.getItem("signed")||"[]");
    let counter = records.length ? (records[records.length-1].id%500)+1 : 1;

    // æ¸²æŸ“è¡¨æ ¼
    function renderTables(){
      pendingBody.innerHTML="";
      signedBody.innerHTML="";
      records.forEach(r=>{
        let row=pendingBody.insertRow();
        row.insertCell().textContent=r.time;
        row.insertCell().textContent=r.id;
        row.insertCell().textContent=`${r.building}-${r.floor}-${r.unit}`;
        row.insertCell().textContent=r.receiver;
        row.insertCell().textContent=r.count;
        row.insertCell().textContent=r.company;
        row.insertCell().textContent=r.note;
        let btn=row.insertCell();
        let sbtn=document.createElement("button");
        sbtn.textContent="ç°½æ”¶";
        sbtn.onclick=()=>{signRecord(r.id)};
        btn.appendChild(sbtn);
      });
      signed.forEach(r=>{
        let row=signedBody.insertRow();
        row.insertCell().textContent=r.time;
        row.insertCell().textContent=r.id;
        row.insertCell().textContent=`${r.building}-${r.floor}-${r.unit}`;
        row.insertCell().textContent=r.receiver;
        row.insertCell().textContent=r.count;
        row.insertCell().textContent=r.company;
        row.insertCell().textContent=r.note;
      });
      localStorage.setItem("records",JSON.stringify(records));
      localStorage.setItem("signed",JSON.stringify(signed));
    }

    // ç°½æ”¶
    function signRecord(id){
      let idx=records.findIndex(r=>r.id===id);
      if(idx>-1){
        signed.push(records[idx]);
        records.splice(idx,1);
        renderTables();
      }
    }

    // æ–°å¢ç´€éŒ„
    form.onsubmit=(e)=>{
      e.preventDefault();
      const rec={
        id:counter,
        time:new Date().toLocaleString(),
        building:buildingSel.value,
        floor:floorSel.value,
        unit:unitSel.value,
        receiver:document.getElementById("receiver").value,
        count:document.getElementById("count").value,
        company:document.getElementById("company").value,
        note:document.getElementById("note").value
      };
      counter = counter===500?1:counter+1;
      records.push(rec);
      addToList(receiverList,rec.receiver);
      addToList(companyList,rec.company);
      renderTables();
      form.reset();
      status.textContent="âœ… å·²æ–°å¢";
      setTimeout(()=>status.textContent="",1500);
    };

    function addToList(datalist,value){
      if(value && ![...datalist.options].some(o=>o.value===value)){
        let opt=document.createElement("option");
        opt.value=value; datalist.appendChild(opt);
      }
    }

    // åŒ¯å‡º CSV
    function exportCSV(data,name){
      let csv="æ™‚é–“,æµæ°´è™Ÿ,åœ°å€,æ”¶ä»¶äºº,ä»¶æ•¸,è²¨é‹å…¬å¸,å‚™è¨»\n";
      data.forEach(r=>{
        csv+=[r.time,r.id,`${r.building}-${r.floor}-${r.unit}`,r.receiver,r.count,r.company,r.note].join(",")+"\n";
      });
      let blob=new Blob([csv],{type:"text/csv"});
      let a=document.createElement("a");
      a.href=URL.createObjectURL(blob);
      a.download=name; a.click();
    }

    document.getElementById("exportToday").onclick=()=>exportCSV(records.filter(r=>r.time.startsWith(new Date().toLocaleDateString())),"today.csv");
    document.getElementById("exportAll").onclick=()=>exportCSV(records.concat(signed),"all.csv");
    document.getElementById("exportPending").onclick=()=>exportCSV(records,"pending.csv");
    document.getElementById("exportSigned").onclick=()=>exportCSV(signed,"signed.csv");
    document.getElementById("clearAll").onclick=()=>{ if(confirm("ç¢ºå®šæ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")){records=[];signed=[];counter=1;renderTables();} };

    renderTables();
  </script>
</body>
</html>
