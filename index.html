<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>SimpleReceiveLite v3</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; color:#0f172a }
    h1 { color: #2c3e50; margin-bottom:8px }
    label { display: block; margin-top: 10px; }
    select, input { padding: 6px 8px; margin-top: 5px; width: 220px; }
    button { margin-top: 12px; padding: 8px 14px; border:0; border-radius:6px; background:#22c55e; color:#fff; cursor:pointer }
    button.secondary { background:#0ea5e9 }
    button.warn { background:#ef4444 }
    table { border-collapse: collapse; margin-top: 18px; width: 100%; }
    th, td { border: 1px solid #e5e7eb; padding: 8px; text-align: center; font-size:14px }
    th { background: #f8fafc; }
    .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .tip{color:#64748b; font-size:12px}
  </style>
</head>
<body>
  <h1>ğŸ“¦ SimpleReceiveLite v3</h1>
  <div class="tip">ï¼ˆå·²å…§å»º ä½å€æœå°‹ + CSV åŒ¯å‡ºï¼šä»Šæ—¥ / å…¨éƒ¨ï¼‰</div>

  <form id="receiveForm">
    <label>æ£Ÿåˆ¥ï¼š
      <select id="building" required>
        <option value="">è«‹é¸æ“‡</option>
        <option value="47">ç”²æ£Ÿ (47)</option>
        <option value="47-7">ä¹™æ£Ÿ (47-7)</option>
        <option value="47-6">ä¸™æ£Ÿ (47-6)</option>
        <option value="47-5">ä¸æ£Ÿ (47-5)</option>
        <option value="47-3">æˆŠæ£Ÿ (47-3)</option>
        <option value="47-1">å·±æ£Ÿ (47-1)</option>
      </select>
    </label>

    <label>æ¨“å±¤ï¼š
      <select id="floor" required></select>
    </label>

    <label>æˆ¶è™Ÿï¼š
      <select id="unit" required></select>
    </label>

    <label>è²¨ä»¶é¡å‹ï¼š
      <select id="type" required>
        <option value="">è«‹é¸æ“‡</option>
        <option value="åŒ…è£¹">åŒ…è£¹</option>
        <option value="æ›è™Ÿ">æ›è™Ÿ</option>
      </select>
    </label>

    <label>æ”¶ä»¶äººï¼š
      <input id="receiver" required placeholder="ä½æˆ¶å§“å" />
    </label>

    <label>ä»¶æ•¸ï¼š
      <input id="count" type="number" min="1" value="1" required />
    </label>

    <label>è²¨é‹å…¬å¸ï¼š
      <input id="company" list="companyList" placeholder="é¸æˆ–è¼¸å…¥" />
      <datalist id="companyList">
        <option value="å¤§æ¦®">
        <option value="æ–°ç«¹">
        <option value="å®…é…é€š">
        <option value="å®…æ€¥ä¾¿">
        <option value="å…¶ä»–">
      </datalist>
    </label>

    <label>å‚™è¨»ï¼š
      <input id="note" placeholder="æ“ºæ”¾ä½ç½®æˆ–å‚™è¨»" />
    </label>

    <button type="submit">æ–°å¢ç´€éŒ„</button>
    <span id="status" class="tip"></span>
  </form>

  <div class="toolbar">
    <button id="searchBtn" class="secondary">ä¾ä½å€æœå°‹</button>
    <button id="exportToday" class="secondary">ä¸‹è¼‰ä»Šæ—¥ç´€éŒ„ (CSV)</button>
    <button id="exportAll" class="secondary">ä¸‹è¼‰å…¨éƒ¨ç´€éŒ„ (CSV)</button>
    <button id="clearAll" class="warn" title="åƒ…æ¸…é™¤æœ¬æ©Ÿä¿å­˜çš„è¡¨æ ¼è³‡æ–™">æ¸…ç©ºç´€éŒ„</button>
  </div>

  <table id="recordTable">
    <thead>
      <tr>
        <th>æ™‚é–“</th>
        <th>æµæ°´è™Ÿ</th>
        <th>æ£Ÿåˆ¥</th>
        <th>æ¨“å±¤</th>
        <th>æˆ¶è™Ÿ</th>
        <th>è²¨ä»¶é¡å‹</th>
        <th>æ”¶ä»¶äºº</th>
        <th>ä»¶æ•¸</th>
        <th>è²¨é‹å…¬å¸</th>
        <th>å‚™è¨»</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const form = document.getElementById("receiveForm");
    const tableBody = document.querySelector("#recordTable tbody");
    const buildingSel = document.getElementById("building");
    const floorSel = document.getElementById("floor");
    const unitSel = document.getElementById("unit");

    let records = JSON.parse(localStorage.getItem("records") || "[]");
    let counter = records.length ? (records[records.length-1].id % 500)+1 : 1;

    // åˆå§‹åŒ–æ¨“å±¤ã€æˆ¶è™Ÿ
    function populateFloors() {
      floorSel.innerHTML = '<option value="">è«‹é¸æ“‡</option>';
      for(let i=1;i<=14;i++) floorSel.innerHTML += `<option value="${i}æ¨“">${i}æ¨“</option>`;
    }
    function populateUnits() {
      unitSel.innerHTML = '<option value="">è«‹é¸æ“‡</option>';
      for(let i=1;i<=8;i++) unitSel.innerHTML += `<option value="ä¹‹${i}">ä¹‹${i}</option>`;
    }
    populateFloors(); populateUnits();

    // æ¸²æŸ“è¡¨æ ¼
    function render(data=records) {
      tableBody.innerHTML="";
      data.forEach(r=>{
        let row=tableBody.insertRow();
        row.insertCell().textContent=r.time;
        row.insertCell().textContent=r.id;
        row.insertCell().textContent=r.building;
        row.insertCell().textContent=r.floor;
        row.insertCell().textContent=r.unit;
        row.insertCell().textContent=r.type;
        row.insertCell().textContent=r.receiver;
        row.insertCell().textContent=r.count;
        row.insertCell().textContent=r.company;
        row.insertCell().textContent=r.note;
      });
      localStorage.setItem("records",JSON.stringify(records));
    }
    render();

    // æ–°å¢ç´€éŒ„
    form.addEventListener("submit",e=>{
      e.preventDefault();
      const now=new Date();
      const rec={
        id:counter,
        time:now.toLocaleString(),
        building:buildingSel.value,
        floor:floorSel.value,
        unit:unitSel.value,
        type:document.getElementById("type").value,
        receiver:document.getElementById("receiver").value,
        count:document.getElementById("count").value,
        company:document.getElementById("company").value,
        note:document.getElementById("note").value
      };
      if(records.length>=500) records.shift(); // è¶…é500åˆªæœ€èˆŠ
      records.push(rec);
      counter = counter%500+1;
      render();
      form.reset();
    });

    // åŒ¯å‡º CSV
    function exportCSV(data,filename){
      let csv="æ™‚é–“,æµæ°´è™Ÿ,æ£Ÿåˆ¥,æ¨“å±¤,æˆ¶è™Ÿ,è²¨ä»¶é¡å‹,æ”¶ä»¶äºº,ä»¶æ•¸,è²¨é‹å…¬å¸,å‚™è¨»\n";
      data.forEach(r=> csv+=[r.time,r.id,r.building,r.floor,r.unit,r.type,r.receiver,r.count,r.company,r.note].join(",")+"\n");
      let blob=new Blob([csv],{type:"text/csv"});
      let url=URL.createObjectURL(blob);
      let a=document.createElement("a"); a.href=url; a.download=filename; a.click();
      URL.revokeObjectURL(url);
    }
    document.getElementById("exportToday").onclick=()=>{
      const today=new Date().toLocaleDateString();
      exportCSV(records.filter(r=>r.time.startsWith(today)),"today.csv");
    };
    document.getElementById("exportAll").onclick=()=>exportCSV(records,"all.csv");

    // ä¾ä½å€æœå°‹
    document.getElementById("searchBtn").onclick=()=>{
      const b=buildingSel.value,f=floorSel.value,u=unitSel.value;
      render(records.filter(r=>r.building===b && r.floor===f && r.unit===u));
    };

    // æ¸…ç©º
    document.getElementById("clearAll").onclick=()=>{
      if(confirm("ç¢ºå®šæ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")){records=[];counter=1;render();}
    };
  </script>
</body>
</html>
