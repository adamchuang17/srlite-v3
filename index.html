# 這裡我會先生成一個 index.html 範例檔案，包含完整的 SimpleReceiveLite v4 功能整合
# 供用戶下載後可直接在本地打開測試，並且日後可上傳至 GitHub Pages。

html_code = """
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleReceiveLite v4</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { text-align: center; }
        select, input, button { margin: 5px; padding: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table, th, td { border: 1px solid #000; text-align: center; }
        th, td { padding: 8px; }
        canvas { border: 1px solid #000; display: block; margin: 10px auto; }
        .btn { padding: 8px 16px; margin: 5px; cursor: pointer; }
        .flex { display: flex; justify-content: center; flex-wrap: wrap; }
    </style>
</head>
<body>
    <h1>📦 SimpleReceiveLite v4</h1>
    <div class="flex">
        <select id="building"></select>
        <select id="floor"></select>
        <select id="unit"></select>
        <input type="text" id="recipient" placeholder="收件人">
        <select id="carrier"></select>
        <button class="btn" onclick="addRecord()">加入待簽收</button>
        <button class="btn" onclick="downloadPDF()">下載 PDF</button>
    </div>
    <canvas id="signature" width="300" height="150"></canvas>
    <div class="flex">
        <button class="btn" onclick="clearSignature()">清除簽名</button>
        <button class="btn" onclick="saveSignature()">簽名完成</button>
    </div>
    <h3>待簽收</h3>
    <table id="pendingTable">
        <thead>
            <tr><th>流水號</th><th>住址</th><th>收件人</th><th>貨運公司</th><th>簽名</th><th>操作</th></tr>
        </thead>
        <tbody></tbody>
    </table>
    <h3>已簽收</h3>
    <table id="signedTable">
        <thead>
            <tr><th>流水號</th><th>住址</th><th>收件人</th><th>貨運公司</th><th>簽名</th></tr>
        </thead>
        <tbody></tbody>
    </table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
let serial = 1;
let signaturePad;
const building = document.getElementById('building');
const floor = document.getElementById('floor');
const unit = document.getElementById('unit');
const carrier = document.getElementById('carrier');
const pendingTable = document.getElementById('pendingTable').querySelector('tbody');
const signedTable = document.getElementById('signedTable').querySelector('tbody');
const canvas = document.getElementById('signature');
const ctx = canvas.getContext('2d');
let drawing = false;

const carriers = ["大榮","新竹","宅配通","宅急便","其他"];
const buildings = ["甲","乙","丙","丁","戊","己"];

// 初始化下拉
function initDropdowns(){
    buildings.forEach(b => building.add(new Option(b,b)));
    for(let i=1;i<=14;i++) floor.add(new Option(i+"樓",i));
    for(let i=1;i<=8;i++) unit.add(new Option("之"+i,i));
    carriers.forEach(c => carrier.add(new Option(c,c)));
}

// 加入待簽收
function addRecord(){
    const addr = building.value + floor.value + "之" + unit.value;
    const rec = document.getElementById('recipient').value;
    const car = carrier.value;
    if(!addr || !rec) return alert("請輸入完整資訊");

    let row = pendingTable.insertRow();
    row.insertCell(0).innerText = serial;
    row.insertCell(1).innerText = addr;
    row.insertCell(2).innerText = rec;
    row.insertCell(3).innerText = car;
    row.insertCell(4).innerHTML = "<img src='"+canvas.toDataURL()+"' width='100'>";
    let btnCell = row.insertCell(5);
    let btn = document.createElement("button");
    btn.innerText = "簽收完成";
    btn.onclick = () => signRecord(row);
    btnCell.appendChild(btn);

    serial = serial % 500 + 1;
    clearSignature();
}

// 簽收
function signRecord(row){
    signedTable.appendChild(row);
    row.deleteCell(5); // 移除操作按鈕
}

// 簽名板事件
canvas.addEventListener('mousedown', e => { drawing = true; ctx.beginPath(); ctx.moveTo(e.offsetX,e.offsetY); });
canvas.addEventListener('mousemove', e => { if(drawing){ ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke(); }});
canvas.addEventListener('mouseup', () => drawing=false);

function clearSignature(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
}
function saveSignature(){
    alert("簽名已保存，可加入紀錄");
}

// 下載 PDF
function downloadPDF(){
    const { jsPDF } = window.jspdf;
    html2canvas(document.body).then(canvas => {
        const img = canvas.toDataURL("image/png");
        const pdf = new jsPDF('p','mm','a4');
        let width = pdf.internal.pageSize.getWidth();
        let height = canvas.height * width / canvas.width;
        pdf.addImage(img,'PNG',0,0,width,height);
        pdf.save("signed_records.pdf");
    });
}

initDropdowns();
</script>
</body>
</html>
"""

# 將檔案寫出到本地，供用戶下載
file_path = "/mnt/data/index_final_v4.html"
with open(file_path, "w", encoding="utf-8") as f:
    f.write(html_code)

file_path
